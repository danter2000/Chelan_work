---
title: "Chelan_PUD_Work"
author: "Dante Ramirez"
date: '2023-04-24'
output: html_document
---

```{r setup, warning = F, message = F}

# General Data Tidying
library(tidyverse)
library(janitor)
library(data.table)

# For Animations
library(ggiraph)
library(gganimate)

# For Dashboard
library(shinydashboard)

chelan_df <- read_csv(file= "PreAssignmentDataSet_StatorTemp.csv") %>%
  clean_names()

```

```{r Q1}

chelan_df_long <- chelan_df %>%
  pivot_longer(cols = -c(1,2), 
               names_to = c("unit_num", ".value"), 
               names_pattern = "c_(\\d+)_(\\w+)_") %>%
               mutate(unit_num = as.factor(as.numeric(unit_num)))
              

chelan_df_long$unit_num <- paste("Unit C", chelan_df_long$unit_num, sep = "")

colSums(is.na(chelan_df_long))
sum(is.na(chelan_df_long))

chelan_df_long[is.na(chelan_df_long)] <- 0

chelan_df_long <- chelan_df_long %>%
  mutate(unit_status = ifelse(total_current > 10, "On", "Off"))

```

```{r Q2}

chelan_df_long %>% filter(unit_num == "Unit C6",
                          unit_status == "Off") %>%
  nrow()

```

```{r Q3 and Q4}

chelan_df_long %>% filter(unit_num == "Unit C6") %>% 
  group_by(month = lubridate::floor_date(timestamp_utc, 'month')) %>%
  summarise(monthly_offline_hrs = sum(unit_status == "Off"),
            monthly_offline_prop = round(sum(unit_status == "Off") / length(unit_status),
                                         3))

```

```{r Q5}

chelan_df_long %>% group_by(unit_num) %>%
  summarise(online_hrs = sum(unit_status == "On"))

```

```{r Q6}

chelan_df_long %>% filter(unit_status = "Off") %>%
  group_by(hour = lubridate::floor_date(timestamp_utc, '1 hour')) %>%
  summarise(offline_hours_totals = sum(unit_status == "Off")) %>%
```

```{r Q7}



```

```{r Q8}



```

```{r Q9}

plot_with_minmax <- function(data, x_var, y_var) {
# Find the indices of the minimum and maximum values of y_var
min_idx <- which.min(data[[y_var]])
max_idx <- which.max(data[[y_var]])
# Create the plot
ggplot(data, aes_string(x = x_var, y = y_var, color = y_var)) +
geom_point(size = 2) +
scale_color_gradient(low = "blue", high = "red") +
geom_point(data = data[min_idx, ], aes_string(x = x_var, y = y_var, color = "green", size = 4)) +
geom_point(data = data[max_idx, ], aes_string(x = !!sym(x_var), y = !!sym(y_var)), color = "purple", size = 4)
}
plot_with_minmax(chelan_df_long_may, "timestamp_utc", "avg_winding_temp_c")
plot_with_minmax <- function(data, x_var, y_var) {
# Find the indices of the minimum and maximum values of y_var
min_idx <- which.min(data[[y_var]])
max_idx <- which.max(data[[y_var]])
# Create the plot
ggplot(data, aes(x = !!sym(x_var), y = !!sym(y_var), color = !!sym(y_var))) +
geom_point(size = 2) +
scale_color_gradient(low = "blue", high = "red") +
geom_point(data = data[min_idx, ], aes(x = !!sym(x_var), y = !!sym(y_var)), color = "green", size = 4) +
geom_point(data = data[max_idx, ], aes(x = !!sym(x_var), y = !!sym(y_var)), color = "purple", size = 4)
}
plot_with_minmax(chelan_df_long_may, "timestamp_utc", "avg_winding_temp_c")


```